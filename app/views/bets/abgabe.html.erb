<h1>Tippabgabe</h1>


	<form method="get">
		<% @cup_options = Cup.all %>
		<%= select_tag(:cup_id, options_from_collection_for_select(@cup_options, "id", "name", selected = params[:cup_id])) %>
		<% unless params[:cup_id].nil? %>
			<% @options = Round.where(:cup_id => params[:cup_id]) %>
			<%= select_tag(:round_id, options_from_collection_for_select(@options, "id", "name", selected = params[:round_id])) %>
		<% end -%>
		<input type="submit" value="Filter" %>
	</form>

<% unless params[:cup_id].nil? %>
	<!-- comment out -->
	<!-- hier Schalter für Spieltag vor und zurück einfügen -->
	<% if false %> 
		<div class="change_round">
			<% if @previousround.exists? %>
				<%= link_to 'vorheriger Spieltag', abgabe_path(:round_id => @previousround.id) %>
			<% end -%>
			<% if @nextround.exists? %>
				<%= link_to 'nächster Spieltag', abgabe_path(:round_id => @nextround.id) %>
			<% end -%>
		</div> -->
	<% end -%>
	<!-- end comment out -->

	<table class="table table-striped table-condensed">
		<thread>
			<tr>
				<th>Runde</th>
				<th>Anstoß</th>
				<th></th>
				<th>Ergebnis</th>
				<th>Tipp</th>
				<th>Punkte</th>
			</tr>
		</thread>
		<tbody>
		<% @games.each do |game| %>
			<% bet = @bets.find_by_game_id(game.id) %>
			<tr>
				<td><%= Round.find(game.round_id).name %></td>
				<td><%= game.kickoff.strftime("%d.%m.%y %H:%M") %></td>
				<td><%= Team.find(game.home_team).name %> - <%= Team.find(game.away_team).name %></td>
				<td>
					<% if game.home_score.nil? %>
						 - : -
					<% else %>
						<%= game.home_score %> : <%= game.away_score %>
					<% end %>
				</td>
				<td>
					<% if Time.now >= game.kickoff %>
						<% if @bets.exists?(:game_id => game.id) %>
							<%= bet.home_bet %> : <%= bet.away_bet %>
						<% else %>
							- : -
						<% end %>
					<% else %>
						<% if @bets.exists?(:game_id => game.id) %>
							<%= bet.home_bet %> : <%= bet.away_bet %>
							<% if game.home_score.nil? %>
								 | <%= link_to 'ändern', edit_bet_path(bet, :game_id => game.id) %> | 
								<%= link_to 'löschen', bet, :method => :delete, :confirm => "sicher?" %>
							<% end %>
						<% else %>
						<%= link_to 'Tipp abgeben', new_bet_path(:game_id => game.id) %>
						<% end %>
					<% end %>
				</td>
				<td>
					<% if game.home_score.nil? %>
						--
					<% else %>
						<% if bet.nil? %>
							-
						<% else %>
							<%= bet.points %>
						<% end %>
					<% end %>
				</th>
			</tr>		
		<% end %>
		</tbody>
	</table>
<% end -%>